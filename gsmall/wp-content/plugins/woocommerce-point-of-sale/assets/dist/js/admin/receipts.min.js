"use strict";function ownKeys(t,e){var o,i=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}!function(s,o){var c={admin:wc_pos_params,receipts:wc_pos_admin_receipts_params},n={id:"#wc-pos-receipt-form",watchFields:['[name="name"]','[name="show_title"]','[name="title_position"]','[name="width"]','[name="logo"]','[name="logo_position"]','[name="logo_size"]','[name="outlet_details_position"]','[name="show_shop_name"]','[name="show_outlet_name"]','[name="show_outlet_address"]','[name="show_outlet_contact_details"]','[name="social_details_position"]','[name="show_social_twitter"]','[name="show_social_facebook"]','[name="show_social_instagram"]','[name="show_social_snapchat"]','[name="show_wifi_details"]','[name="show_tax_number"]','[name="tax_number_label"]','[name="tax_number_position"]','[name="show_order_date"]','[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]','[name="show_customer_name"]','[name="show_customer_email"]','[name="show_customer_phone"]','[name="show_customer_shipping_address"]','[name="show_cashier_name"]','[name="cashier_name_format"]','[name="product_details_layout"]','[name="show_register_name"]','[name="show_product_image"]','[name="show_product_sku"]','[name="show_product_cost"]','[name="show_product_discount"]','[name="show_no_items"]','[name="show_tax_summary"]','[name="show_order_barcode"]','[name="header_text"]','[name="footer_text"]','[name="text_size"]'],cachedDateFormats:{},cachedTimeFormats:{},logoUploader:null,init:function(){s(this.id).on("submit",this.submitted).on("change keyup","input, select, textarea",this.changed).on("change keyup",this.watchFields.join(","),this.updatePreview).on("click","#customize-control-logo button.upload",this.selectLogo).on("click","#customize-control-logo button.remove",this.removeLogo).on("click","#customize-control-logo button.upload, #customize-control-logo button.remove",this.changed).find(this.watchFields.filter(function(e){return-1===['[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]'].indexOf(e)}).join(",")).trigger("change");var e=wp.codeEditor.initialize(s("#custom_css"),{codemirror:{lineNumbers:!0,mode:"css",indentUnit:4,indentWithTabs:!0}});this.updatePreviewCss(e.codemirror.doc.getValue()),e.codemirror.on("change",function(e){n.updatePreviewCss(e.doc.getValue()),s("#custom_css").val(e.doc.getValue())})},validate:function(e){var t={},o={};if(e.forEach(function(e){t[e.name]=e.value}),void 0!==t.name&&0!==t.name.trim().length||(o.name_is_empty=c.receipts.i18n_field_name_empty),void 0===t.width||0===t.width.trim().length?o.width_is_empty=c.receipts.i18n_field_width_empty:Number(t.width)<0&&(o.width_is_negative=c.receipts.i18n_field_width_negative),0<Object.keys(o).length){var i=s("#customize-notifications-area"),a=s(".wp-full-overlay-sidebar-content");i.children("ul").html(""),Object.values(o).forEach(function(e){i.children("ul").append('\n\t\t\t\t\t\t<li class="notice notice-error" data-code="client_side_error" data-type="error">\n\t\t\t\t\t\t\t<div class="notification-message">'.concat(e,"</div>\n\t\t\t\t\t\t</li>"))});var r=i.outerHeight()+1;return a.css("top",45+r+"px"),!1}return!0},submitted:function(e){var t;e.preventDefault(),s("body").addClass("saving"),n.validate(s(this).serializeArray())?(t={receipt_id:c.receipts.receipt_id,action:"wc_pos_update_receipt",data:s(this).serializeArray().reduce(function(e,t){return _objectSpread(_objectSpread({},e),{},_defineProperty({},t.name,t.value))}),security:c.receipts.update_receipt_nonce},s.ajax({url:c.admin.ajax_url,data:t,type:"POST",success:function(e){s("body").removeClass("saving"),e.success?(s(n.id).find('input[type="submit"]').prop("disabled",!0),0===c.receipts.receipt_id.length&&(o.location.href=c.admin.admin_url+"post.php?post="+e.data.id+"&action=edit")):o.alert(e.data.error)}})):s("body").removeClass("saving")},changed:function(){s(n.id).find('input[type="submit"]').prop("disabled",!1)},updatePreview:function(e){var t,o=s(e.target),i=o.attr("name"),a=o.val();if("name"===i&&s("#receipt-name").html(a),"show_title"===i&&(s(o).is(":checked")?s("#receipt-title").show():s("#receipt-title").hide()),"title_position"===i&&s("#receipt-title").css("text-align",a),"width"===i&&(a=(a=parseInt(a))&&0<a&&a<=120?"".concat(a,"mm"):"100%",s("#receipt-preview").css("width",a)),"logo"===i&&(0===parseInt(a)||0===a.length?s("#receipt-logo").hide():s("#receipt-logo").show()),"logo_position"===i&&s("#receipt-logo").css("text-align",a),"logo_size"===i){var r="auto";switch(a){case"normal":r="6cm";break;case"small":r="2cm";break;case"large":r="100%"}s("#receipt-logo img").css("width",r)}if("outlet_details_position"===i&&(s("#receipt-outlet-details").css("text-align",a),s("#receipt-outlet-details-footer").css("text-align",a)),"show_shop_name"===i&&(s(o).is(":checked")?s("#receipt-shop-name").show():s("#receipt-shop-name").hide()),"show_outlet_name"===i&&(s(o).is(":checked")?s("#receipt-outlet-name").show():s("#receipt-outlet-name").hide()),"show_outlet_address"===i&&(s(o).is(":checked")?s("#receipt-outlet-address").show():s("#receipt-outlet-address").hide()),"show_outlet_contact_details"===i&&(s(o).is(":checked")?s("#receipt-outlet-contact-details").show():s("#receipt-outlet-contact-details").hide()),"social_details_position"===i&&(t=s("#receipt-social-details"),"header"===a?t.insertAfter("#receipt-wifi-details"):"footer"===a&&t.appendTo("#receipt-outlet-details-footer")),"show_social_twitter"===i&&(s(o).is(":checked")?s("#receipt-social-twitter").show():s("#receipt-social-twitter").hide()),"show_social_facebook"===i&&(s(o).is(":checked")?s("#receipt-social-facebook").show():s("#receipt-social-facebook").hide()),"show_social_instagram"===i&&(s(o).is(":checked")?s("#receipt-social-instagram").show():s("#receipt-social-instagram").hide()),"show_social_snapchat"===i&&(s(o).is(":checked")?s("#receipt-social-snapchat").show():s("#receipt-social-snapchat").hide()),"show_wifi_details"===i&&(s(o).is(":checked")?s("#receipt-wifi-details").show():s("#receipt-wifi-details").hide()),"show_tax_number"===i&&(s(o).is(":checked")?s("#receipt-tax-number").show():s("#receipt-tax-number").hide()),"tax_number_label"===i&&(0<a.length?s("#receipt-tax-number-label").html(a+":"):s("#receipt-tax-number-label").html("")),"tax_number_position"===i&&s("#receipt-tax-number").css("text-align",a),"show_order_date"===i&&(s(o).is(":checked")?s("#receipt-order-date").show():s("#receipt-order-date").hide()),"order_date_format"===i||"order_date_format_custom"===i){if(a=""===s('[name="order_date_format"]:checked').val()?s('[name="order_date_format_custom"]').val():a,void 0!==n.cachedDateFormats[a])return void s("#receipt-order-date td .date").html(n.cachedDateFormats[a]);s.ajax({url:c.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:c.receipts.date_i18n_nonce,data:{format:a,date:c.receipts.time}},type:"POST",success:function(e){e.success&&(s("#receipt-order-date td .date").html(e.data.date),n.cachedDateFormats[a]=e.data.date)}})}if("order_time_format"===i||"order_time_format_custom"===i){if(a=""===s('[name="order_time_format"]:checked').val()?s('[name="order_time_format_custom"]').val():a,void 0!==n.cachedTimeFormats[a])return void s("#receipt-order-date td .time").html(n.cachedTimeFormats[a]);s.ajax({url:c.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:c.receipts.date_i18n_nonce,data:{format:a,date:c.receipts.date}},type:"POST",success:function(e){e.success&&(s("#receipt-order-date td .time").html(e.data.date),n.cachedTimeFormats[a]=e.data.date)}})}"show_customer_name"===i&&(s(o).is(":checked")?s("#receipt-customer-name").show():s("#receipt-customer-name").hide()),"show_customer_email"===i&&(s(o).is(":checked")?s("#receipt-customer-email").show():s("#receipt-customer-email").hide()),"show_customer_phone"===i&&(s(o).is(":checked")?s("#receipt-customer-phone").show():s("#receipt-customer-phone").hide()),"show_customer_shipping_address"===i&&(s(o).is(":checked")?s("#receipt-customer-shipping-address").show():s("#receipt-customer-shipping-address").hide()),"show_cashier_name"===i&&(s(o).is(":checked")?s("#receipt-cashier-name").show():s("#receipt-cashier-name").hide()),"cashier_name_format"===i&&s("#receipt-cashier-name .cashier").html(s("#receipt-cashier-name").data(a)),"product_details_layout"===i&&("single"===a?(s(".receipt-product-details-layout-single").css("display","table-header-group"),s(".receipt-product-details-layout-multiple").css("display","none")):(s(".receipt-product-details-layout-multiple").css("display","table-header-group"),s(".receipt-product-details-layout-single").css("display","none"))),"show_register_name"===i&&(s(o).is(":checked")?s("#receipt-register-name").show():s("#receipt-register-name").hide()),"show_product_image"===i&&(s(o).is(":checked")?(s("thead th.image").show(),s(".receipt-product-image").show()):(s("thead th.image").hide(),s(".receipt-product-image").hide())),"show_product_sku"===i&&(s(o).is(":checked")?s(".receipt-product-sku").show():s(".receipt-product-sku").hide()),"show_product_cost"===i&&(s(o).is(":checked")?(s("thead th.cost").show(),s(".receipt-product-cost").show()):(s("thead th.cost").hide(),s(".receipt-product-cost").hide())),"show_product_discount"===i&&(s(o).is(":checked")?(s("#receipt-preview .show-if-discount-enabled").show(),s("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","line-through")):(s("#receipt-preview .show-if-discount-enabled").hide(),s("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","none"))),"show_no_items"===i&&(s(o).is(":checked")?s("#receipt-no-items").show():s("#receipt-no-items").hide()),"show_tax_summary"===i&&(s(o).is(":checked")?s("#receipt-tax-summary").show():s("#receipt-tax-summary").hide()),"show_order_barcode"===i&&(s(o).is(":checked")?s("#receipt-order-barcode").show():s("#receipt-order-barcode").hide()),"header_text"===i&&s("#receipt-header-text").html(a),"footer_text"===i&&s("#receipt-footer-text").html(a),"text_size"===i&&s("#receipt-preview").removeClass("text-tiny text-small text-normal text-large").addClass("text-"+a)},selectLogo:function(){if(!n.logoUploader)return n.logoUploader=wp.media.frames.logoUploader=wp.media({title:"Select a Receipt Logo ",button:{text:"Set Receipt Logo"},multiple:!1,library:{type:"image/png,image/jpeg"}}),n.logoUploader.on("select",function(){var e=n.logoUploader.state().get("selection").first().toJSON();s("#logo").val(e.id).trigger("change"),s("#customize-control-logo").addClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",e.url),s("#receipt-preview #receipt-logo img").attr("src",e.url)}),n.logoUploader.open(),!1;n.logoUploader.open()},removeLogo:function(){return s("#logo").val("").trigger("change"),s("#customize-control-logo").removeClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",""),s("#receipt-preview #receipt-logo img").attr("src",""),!1},updatePreviewCss:function(e){s("#receipt-custom-css").replaceWith('<style type="text/less" id="receipt-custom-css">#receipt-preview {'.concat(e,"}</style>")),o.less&&o.less.refresh(!0)}};n.init(),s(n.id).find("#save").prop("disabled",!1),s(".customize-pane-parent").on("click",".accordion-section-title",function(e){e.preventDefault();var t=s(this).parent().attr("aria-owns"),o=s("#"+t);s(".wp-full-overlay-sidebar-content").addClass("section-open"),o.addClass("open")}),s(".customize-pane-child").on("click",".customize-section-back",function(e){s(this).parents(".customize-pane-child").removeClass("open"),s(".wp-full-overlay-sidebar-content").removeClass("section-open")})}(jQuery,window,document);